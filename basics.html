<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
  <head>
    <meta charset="utf-8"/>
    <meta name="description" content="There are three basic commands in Rultor that automate merging, deploying and releasing" />
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="icon" type="image/png" href="//img.rultor.com/logo-128x128.png">
    <link rel="shortcut icon" href="//img.rultor.com/logo-128x128.png" />
    <link rel="alternate" type="application/rss+xml" title="RSS" href="http://doc.thindeck.com/rss.xml"/>
    <link rel="author" href="//plus.google.com/u/0/114792568016408327418?rel=author" />
    <link rel="stylesheet" href="/css/layout.css?28a0623cf"/>
    <link rel="canonical" href="//doc.rultor.com/basics.html" />
    <title>Basic Commands</title>
    <script>//<![CDATA[
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-1963507-28', 'auto');
      ga('send', 'pageview');
    //]]></script>
  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <a href="/">
          <img src="//doc.rultor.com/images/logo.svg" class="logo" alt="logo"/>
        </a>
      </header>
      <section class="main" itemscope itemtype="http://schema.org/Article">
        <a href="https://github.com/yegor256/rultor">
          <img src="//doc.rultor.com/images/fork-me.svg" class="fork-me" alt="fork me in github"/>
        </a>
        <h1 itemprop="headline">Basic Commands</h1>
        <article itemprop="articleBody"><p>There are three main operations you can perform with Rultor:
merge, deploy and release. Every call to Rultor is posted in
a Github issue as a comment (yes, any Github issue, in any Github project!)</p>

<p>Commands must start with <code>@rultor</code> followed by command text.</p>

<p>For example, in a pull request that is ready to be merged
you post a new comment saying, literally:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">@rultor please check and merge this pull request</code></pre></div>

<p>It is important to start a command with <code>@rultor</code> and
mention <code>merge</code> somewhere in the text. All the rest is ignored.
You can achieve exactly the same thing by just posting:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">@rultor merge</code></pre></div>

<p>BTW, by default, only Github project collaborators
can talk to Rultor, although it is
<a href="/reference.html">configurable</a>.</p>

<p>Rultor assigns a unique ID to every build. Build log URLs are created using this IDs.
Every Github comment has a unique number and in Rultor each &quot;talk&quot;(a Github issue, for example)
has a unique number. Rultor build ID is combination of these two numbers.
Take this build for example: <code>http://www.rultor.com/t/11509-297164344</code>.
Here, <code>11509</code> is unique ID of the build inside the talk and <code>297164344</code> is the talk number.
There is no gaurantee that the build number will go consequentially.</p>

<h2 id="merge">Merge</h2>

<p>It is a very good practice, to run your automated build
after merging a pull request into the <code>master</code>
branch and right before pushing changes. When your pull request
is ready, ask Rultor to merge it. Rultor will checkout your
<code>master</code> branch, merge changes into it, run the automated build,
and push the new version of <code>master</code> to your repo.
<a href="http://www.yegor256.com/2014/07/21/read-only-master-branch.html">&quot;Master Branch Must Be Read-Only&quot;</a>
article explains why it is important to use this mechanism and
protect your <code>master</code> against accidental failures.</p>

<p>Don&#39;t forget to create <a href="/reference.html"><code>.rultor.yml</code></a>
in the root directory of your repository and configure the build
automation script there. For example:</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">merge</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">script</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">mvn clean install</span></code></pre></div>

<p>If you don&#39;t configure it, Rultor will try to guess your
build automation tool and call it accordingly. If you
have <code>pom.xml</code> in your root directory &mdash;
it is <a href="http://maven.apache.org/">Maven</a>; if you have
<code>Gemfile</code> &mdash; it is <a href="http://www.bundler.io">Bundler</a>, etc.</p>

<p>We strongly recommend that you configure your script in
<a href="/reference.html"><code>.rultor.yml</code></a>.</p>

<h2 id="deploy">Deploy</h2>

<p>Deployment is when you place a packaged artifact into
your production (or test) environment in order to make it
available for end-users (or testers). Different systems deploy
themselves differently &mdash; Rultor makes it possible to
automate any possible scenario.</p>

<p>All you need to do is define your deployment scenario as
a bash script and configure it in <a href="/reference.html"><code>.rultor.yml</code></a>.</p>

<p>For example, this is how we deploy Rultor
itself (see our <a href="https://github.com/yegor256/rultor/blob/master/.rultor.yml"><code>.rultor.yml</code></a> file):</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">deploy</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">env</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">MAVEN_OPTS</span><span class="p-Indicator">:</span> <span class="s">&quot;-XX:MaxPermSize=256m</span><span class="nv"> </span><span class="s">-Xmx1g&quot;</span>
  <span class="l-Scalar-Plain">script</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="s">&quot;sudo</span><span class="nv"> </span><span class="s">bundle&quot;</span>
    <span class="p-Indicator">-</span> <span class="s">&quot;mvn</span><span class="nv"> </span><span class="s">clean</span><span class="nv"> </span><span class="s">deploy</span><span class="nv"> </span><span class="s">-Prultor</span><span class="nv"> </span><span class="s">--settings</span><span class="nv"> </span><span class="s">../settings.xml&quot;</span>
    <span class="p-Indicator">-</span> <span class="s">&quot;mvn</span><span class="nv"> </span><span class="s">clean</span><span class="nv"> </span><span class="s">site-deploy</span><span class="nv"> </span><span class="s">-Psite</span><span class="nv"> </span><span class="s">-Prempl</span><span class="nv"> </span><span class="s">--settings</span><span class="nv"> </span><span class="s">../settings.xml&quot;</span></code></pre></div>

<p>First, we install all Ruby gems required
for Jekyll (this is how this website is built). Then,
we deploy the system to CloudBees. Then, we deploy the site to Github Pages.</p>

<h2 id="release">Release</h2>

<p>Release is when you package a stable version of your
product and make it available for everybody in an artifact
repository. For example, <a href="http://search.maven.org/">Maven Central</a>
or <a href="http://www.rubygems.org">RubyGems</a>.</p>

<p>The Release command automates this for you. The command does
require one mandatory argument, though. You should call it like this:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">@rultor release, tag=`1.7`</code></pre></div>

<p>Then, in your script you get <code>$tag</code> environment variable,
which will be set to <code>1.7</code>. Your script should change
the version of the product to 1.7 and build it.</p>

<p>This is how we do it in jcabi <a href="https://github.com/jcabi/jcabi/blob/master/.rultor.yml"><code>rultor.yml</code></a>. For example:</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">release</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">script</span><span class="p-Indicator">:</span> <span class="p-Indicator">|</span>
    <span class="no">mvn versions:set &quot;-DnewVersion=$tag&quot;</span>
    <span class="no">git commit -am &quot;$tag&quot;</span>
    <span class="no">mvn clean deploy -Pqulice -Psonatype -Pjcabi</span>
    <span class="no">mvn clean site-deploy -Psite -Prempl --settings ../settings.xml</span></code></pre></div>

<p>We change the version of the product to the one provided in
<code>$tag</code>, then commit the changes, build and deploy to Sonatype. Next,
we build the project site and deploy it to Github Pages.
All the rest is done by Rultor. Basically, this is what will be done:</p>

<ol>
<li>Check out your repository</li>
<li>Run the script configured in <code>.rultor.yml</code></li>
<li>Tag the latest commit as <code>$tag</code></li>
<li>Push the new tag to the repository</li>
</ol>

<p>Of course, if any of these steps fails, the entire command
fails and you get a full log in the Github issue.</p>
</article>
      </section>
      <footer class="footer">
        <p>
          &copy; <a href="http://www.rultor.com"><span itemprop="author">rultor.com</span></a>, 2013-2018
          &nbsp;&nbsp;&nbsp;
          <a href="/contents.html">contents</a>
          &middot;
          <a href="/reference.html">.rultor.yml</a>
          &middot;
          <a href="/terms.html">terms</a>
          &middot;
          <a href="/privacy.html">privacy</a>
        </p>
        <div class="badges">
          <div>
            <span>provisioned by</span>
            <br/>
            <a href="http://aws.amazon.com/">
              <img src="/images/aws-logo.png" style="width:96px" alt="aws logo"/>
            </a>
          </div>
          <div>
            <span>powered by</span>
            <br/>
            <a href="http://www.docker.io">
              <img src="/images/docker-logo.png" style="width:96px" alt="docker logo"/>
            </a>
          </div>
          <div>
            <span>operates at</span>
            <br/>
            <a href="http://www.github.com">
              <img src="/images/github-logo.png" style="width:96px" alt="github logo"/>
            </a>
          </div>
          <div>
            <span>hosted by</span>
            <br/>
            <a href="http://www.heroku.com">
              <img src="/images/heroku-logo.png" style="width:96px" alt="heroku logo"/>
            </a>
          </div>
        </div>
        <div class="badges">
          <a href="http://www.teamed.io">
            <img src="//img.teamed.io/btn.svg" style="width:125px;"
              alt="teamed.io made-by badge"/>
          </a>
        </div>
        <p>
          <a href="https://github.com/yegor256/rultor/commit/28a0623cf">28a0623cf</a>
        </p>
      </footer>
    </div>
    <script type="text/javascript">//<![CDATA[
      (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
      try {
      w.yaCounter25979713 = new Ya.Metrika({id:25979713,
      webvisor:true,
      clickmap:true,
      trackLinks:true,
      accurateTrackBounce:true});
      } catch(e) { }
      });
      var n = d.getElementsByTagName("script")[0],
      s = d.createElement("script"),
      f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";
      if (w.opera == "[object Opera]") {
      d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
      })(document, window, "yandex_metrika_callbacks");
    //]]></script>
  </body>
</html>
